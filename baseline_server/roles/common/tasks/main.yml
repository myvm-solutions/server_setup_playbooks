---
# This playbook contains common plays that will be run on all nodes.

- name: test to see if selinux is running
  command: getenforce
  register: sestatus
  changed_when: false
  when: false # Have to install/enable SELinux first

- name: install apt packages
  # Todo: streamline package list for prod
  ansible.builtin.apt:
    update_cache: yes
    cache_valid_time: 3600
    pkg:
      - screen
      - git
      - vim
      - locate
      - net-tools
      - traceroute
      - nfs-common
      # - rxvt-unicode-256color
      
# This task is important, but make sure systemd-networkd is working/configured before enabling
- name: Purge Network-Manager
  ansible.builtin.apt:
    state: absent
    purge: yes
    autoremove: yes
    pkg:
      - network-manager
  when: false
  

# TODO:

# ## systemd networkd usb bridge on LTS ##
# echo "[Match]
# Name=enx*
# [Network]
# Bridge=br0" | sudo tee /etc/systemd/network/usb.network
# echo "[NetDev]
# Name=br0
# Kind=bridge" | sudo tee /etc/systemd/network/br0.netdev
# echo "[Match]
# Name=br0
# [Network]
# DHCP=no
# #DHCP=yes" | sudo tee /etc/systemd/network/br0.network
# echo "[Match]
# Name=eth*
# #[Link]
# #RequiredForOnline=no
# #MTUBytes=9000
# [Network]
# DHCP=yes
# #LLDP=yes
# " | sudo tee /etc/systemd/network/gigE.network


# garrettj@pine64s0:~$ apt-mark showhold
# armbian-firmware
# linux-bionic-root-next-pine64so
# linux-dtb-next-sunxi64
# linux-image-next-sunxi64
# linux-u-boot-pine64so-next
# ? linux-headers-next-sunxi64 ?


# processes_to_disable="armbian-zram-config armbian-ramlog unattended-upgrades NetworkManager"
# for i in $processes_to_disable; do
#  #sudo systemctl stop $i || echo couldn\'t stop $i
#  sudo systemctl disable $i || echo couldn\'t disable $i
#  systemctl status $i
# done




# - name: Install ntp
#   yum:
#     name: ntp
#     state: present
#   tags: ntp

# - name: Configure ntp file
#   template:
#     src: ntp.conf.j2
#     dest: /etc/ntp.conf
#   tags: ntp
#   notify: restart ntp

# - name: Start the ntp service
#   service:
#     name: ntpd
#     state: started
#     enabled: yes
#   tags: ntp

